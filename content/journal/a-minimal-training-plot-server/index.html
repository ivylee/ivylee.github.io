<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>a minimal training plot server - Ivy Lee</title><meta name="gridsome:hash" content="c035355dcf2811990fb7d6212a2e49c58001871e"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.13"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" data-key="description" name="description" content="Writings by Ivy Lee, Creative Technologist experienced in Data Science, Machine Learning, Deep Learning"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.e0811aa2d901a2d517912241f856735c.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.e0811aa2d901a2d517912241f856735c.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.e0811aa2d901a2d517912241f856735c.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/touchicon.f22e9f3.8adfe1442cdabafcdfc4196418110b5a.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/touchicon.62d22cb.8adfe1442cdabafcdfc4196418110b5a.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/touchicon.1539b60.8adfe1442cdabafcdfc4196418110b5a.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/touchicon.dc0cdc5.8adfe1442cdabafcdfc4196418110b5a.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/touchicon.7b22250.8adfe1442cdabafcdfc4196418110b5a.png"><link rel="preload" href="/assets/css/0.styles.4c587c1d.css" as="style"><link rel="preload" href="/assets/js/app.cff5f43d.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--journal-post-vue.5e923e24.js" as="script"><link rel="prefetch" href="/assets/js/page--node-modules--gridsome--app--pages--404-vue.ab3c8144.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.45a47cdc.js"><link rel="prefetch" href="/assets/js/page--src--pages--journal-vue.e5a6e916.js"><link rel="prefetch" href="/assets/js/page--src--templates--project-post-vue.8b883a54.js"><link rel="stylesheet" href="/assets/css/0.styles.4c587c1d.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <div data-server-rendered="true" id="app" class="layout" data-v-354b4fc1><header class="header" data-v-b3e480f8><div class="container" data-v-b3e480f8><div class="left" data-v-b3e480f8><a href="/" class="home-link active" data-v-b3e480f8><h1 data-v-b3e480f8>Ivy Lee</h1></a></div><nav class="nav right" data-v-b3e480f8><a href="/journal" class="nav__link" data-v-b3e480f8>Journal</a></nav></div></header><div class="journal" data-v-354b4fc1><div class="container journal-container" data-v-354b4fc1><div class="journal-header" data-v-354b4fc1><h1 class="journal-title" data-v-354b4fc1>a minimal training plot server</h1><div class="journal-meta" data-v-354b4fc1><div class="journal-date" data-v-354b4fc1><div data-v-354b4fc1>March 4 2017</div></div></div></div><div class="journal-content" data-v-354b4fc1><p>Training a deep convolutional neural network (CNN) can be a lengthy process.
We usually want to monitor training loss and accuracy and validation loss and accuracy by plotting how these metrics
change as the number of minibatches grows on a graph.
<a href="https://www.tensorflow.org" target="_blank" rel="nofollow noopener noreferrer">Tensorflow</a> provides <a href="https://www.tensorflow.org/get_started/summaries_and_tensorboard" target="_blank" rel="nofollow noopener noreferrer">Tensorboard</a> for visualizing training progress.
Recently I have been playing with <a href="http://pytorch.org" target="_blank" rel="nofollow noopener noreferrer">PyTorch</a>, I really like its expresiveness and flexibility.
Here's a strategy for visualizing training progress with
any learning framework that doesn't provide Tensorboard-equivalent feature out of the box using Python 3.</p>
<p>First of all as a good practice we output relevant metrics into a log file, the log file should be structured in a way
that is easy to parse and extract metrics. We will need to write a parser method, and a plot method to generate desired
graph(s). <a href="http://matplotlib.org" target="_blank" rel="nofollow noopener noreferrer">matplotlib</a>, <a href="http://seaborn.pydata.org" target="_blank" rel="nofollow noopener noreferrer">seaborn</a>, <a href="http://ggplot.yhathq.com" target="_blank" rel="nofollow noopener noreferrer">ggplot</a> or <a href="http://bokeh.pydata.org/en/latest" target="_blank" rel="nofollow noopener noreferrer">bokeh</a> are useful python libraries for graphing.</p>
<p>Then we can use <a href="https://docs.python.org/3/library/asyncio.html" target="_blank" rel="nofollow noopener noreferrer">asyncio</a> to create a background job to plot the metrics we want to visualize and use <a href="http://aiohttp.readthedocs.io/en/stable" target="_blank" rel="nofollow noopener noreferrer">aiohttp</a> to create
a web server that displays and refreshes the graph(s) at a certain interval.</p>
<pre class="language-text"><code class="language-text"># Using python 3.4
import asyncio
import argparse
from aiohttp import web


GRAPH_LOCATION = &quot;static/train_plot.png&quot;


def parser(log_file):
    # read log_file and extract metrics such as
    # minibatch number, training loss, training accuracy,
    # validation loss, validation accuracy
    return metrics


def plot(metrics, output=GRAPH_LOCATION):
    # save output image to GRAPH_LOCATION


def plot_loop(args, loop):
    print(&quot;Updating plot&quot;)
    metrics = parser(args.log_file)
    plot(metrics)
    loop.call_later(args.interval, plot_loop, args, loop)


@asyncio.coroutine
def handler(request):
    interval = int(request.GET.get(&#39;interval&#39;, 30))
    resp = web.StreamResponse(status=200,
                              reason=&#39;OK&#39;,
                              headers={&#39;Content-Type&#39;: &#39;text/html&#39;})

    yield from resp.prepare(request)

    html_str = &quot;&quot;&quot;
        &lt;html&gt;
            &lt;head&gt;
                &lt;meta http-equiv=&#39;refresh&#39; content=&#39;{}&#39;&gt;
            &lt;/head&gt;
            &lt;body&gt;
                &lt;img src=&#39;{}&#39; width=&#39;100%&#39;/&gt;
            &lt;/body&gt;
        &lt;/html&gt;
    &quot;&quot;&quot;.format(interval, GRAPH_LOCATION)
    resp.write(str.encode(html_str))

    yield from resp.drain()
    return resp


@asyncio.coroutine
def build_server(loop, address, port):
    app = web.Application(loop=loop)
    app.router.add_route(&#39;GET&#39;, &quot;/plot&quot;, handler)
    app.router.add_static(&#39;/static&#39;, &quot;static&quot;)
    ret = yield from loop.create_server(app.make_handler(), address, port)
    return ret


if __name__ == &quot;__main__&quot;:
    parser = argparse.ArgumentParser(description=&#39;Training graphs server&#39;)
    parser.add_argument(&#39;log_file&#39;,
                        help=&#39;path to train log file&#39;)
    parser.add_argument(&#39;--interval&#39;, &#39;-i&#39;, default=30,
                        help=&#39;plot interval&#39;)
    parser.add_argument(&#39;--port&#39;, &#39;-p&#39;, default=7777,
                        help=&#39;server port&#39;)
    args = parser.parse_args()

    loop = asyncio.get_event_loop()
    loop.call_soon(plot_loop, args, loop)
    loop.run_until_complete(build_server(loop, &#39;0.0.0.0&#39;, args.port))
    try:
        loop.run_forever()
    except KeyboardInterrupt:
        print(&quot;Server shutting down!&quot;)
        loop.close()</code></pre>
<p>This snippet can also be found <a href="https://gist.github.com/ivylee/f1b00ce54f948e627605598ccf3cf4b9" target="_blank" rel="nofollow noopener noreferrer">here</a>.</p>
</div></div></div><footer class="footer" data-v-0b2ee87e><div class="container" data-v-0b2ee87e><span data-v-0b2ee87e>Copyright Â© 2020</span></div></footer></div>
    <script>window.__INITIAL_STATE__={"data":{"post":{"title":"a minimal training plot server","date":"March 4 2017","content":"\u003Cp\u003ETraining a deep convolutional neural network (CNN) can be a lengthy process.\nWe usually want to monitor training loss and accuracy and validation loss and accuracy by plotting how these metrics\nchange as the number of minibatches grows on a graph.\n\u003Ca href=\"https:\u002F\u002Fwww.tensorflow.org\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003ETensorflow\u003C\u002Fa\u003E provides \u003Ca href=\"https:\u002F\u002Fwww.tensorflow.org\u002Fget_started\u002Fsummaries_and_tensorboard\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003ETensorboard\u003C\u002Fa\u003E for visualizing training progress.\nRecently I have been playing with \u003Ca href=\"http:\u002F\u002Fpytorch.org\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003EPyTorch\u003C\u002Fa\u003E, I really like its expresiveness and flexibility.\nHere's a strategy for visualizing training progress with\nany learning framework that doesn't provide Tensorboard-equivalent feature out of the box using Python 3.\u003C\u002Fp\u003E\n\u003Cp\u003EFirst of all as a good practice we output relevant metrics into a log file, the log file should be structured in a way\nthat is easy to parse and extract metrics. We will need to write a parser method, and a plot method to generate desired\ngraph(s). \u003Ca href=\"http:\u002F\u002Fmatplotlib.org\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Ematplotlib\u003C\u002Fa\u003E, \u003Ca href=\"http:\u002F\u002Fseaborn.pydata.org\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Eseaborn\u003C\u002Fa\u003E, \u003Ca href=\"http:\u002F\u002Fggplot.yhathq.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Eggplot\u003C\u002Fa\u003E or \u003Ca href=\"http:\u002F\u002Fbokeh.pydata.org\u002Fen\u002Flatest\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Ebokeh\u003C\u002Fa\u003E are useful python libraries for graphing.\u003C\u002Fp\u003E\n\u003Cp\u003EThen we can use \u003Ca href=\"https:\u002F\u002Fdocs.python.org\u002F3\u002Flibrary\u002Fasyncio.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Easyncio\u003C\u002Fa\u003E to create a background job to plot the metrics we want to visualize and use \u003Ca href=\"http:\u002F\u002Faiohttp.readthedocs.io\u002Fen\u002Fstable\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Eaiohttp\u003C\u002Fa\u003E to create\na web server that displays and refreshes the graph(s) at a certain interval.\u003C\u002Fp\u003E\n\u003Cpre class=\"language-text\"\u003E\u003Ccode class=\"language-text\"\u003E# Using python 3.4\nimport asyncio\nimport argparse\nfrom aiohttp import web\n\n\nGRAPH_LOCATION = &quot;static\u002Ftrain_plot.png&quot;\n\n\ndef parser(log_file):\n    # read log_file and extract metrics such as\n    # minibatch number, training loss, training accuracy,\n    # validation loss, validation accuracy\n    return metrics\n\n\ndef plot(metrics, output=GRAPH_LOCATION):\n    # save output image to GRAPH_LOCATION\n\n\ndef plot_loop(args, loop):\n    print(&quot;Updating plot&quot;)\n    metrics = parser(args.log_file)\n    plot(metrics)\n    loop.call_later(args.interval, plot_loop, args, loop)\n\n\n@asyncio.coroutine\ndef handler(request):\n    interval = int(request.GET.get(&#39;interval&#39;, 30))\n    resp = web.StreamResponse(status=200,\n                              reason=&#39;OK&#39;,\n                              headers={&#39;Content-Type&#39;: &#39;text\u002Fhtml&#39;})\n\n    yield from resp.prepare(request)\n\n    html_str = &quot;&quot;&quot;\n        &lt;html&gt;\n            &lt;head&gt;\n                &lt;meta http-equiv=&#39;refresh&#39; content=&#39;{}&#39;&gt;\n            &lt;\u002Fhead&gt;\n            &lt;body&gt;\n                &lt;img src=&#39;{}&#39; width=&#39;100%&#39;\u002F&gt;\n            &lt;\u002Fbody&gt;\n        &lt;\u002Fhtml&gt;\n    &quot;&quot;&quot;.format(interval, GRAPH_LOCATION)\n    resp.write(str.encode(html_str))\n\n    yield from resp.drain()\n    return resp\n\n\n@asyncio.coroutine\ndef build_server(loop, address, port):\n    app = web.Application(loop=loop)\n    app.router.add_route(&#39;GET&#39;, &quot;\u002Fplot&quot;, handler)\n    app.router.add_static(&#39;\u002Fstatic&#39;, &quot;static&quot;)\n    ret = yield from loop.create_server(app.make_handler(), address, port)\n    return ret\n\n\nif __name__ == &quot;__main__&quot;:\n    parser = argparse.ArgumentParser(description=&#39;Training graphs server&#39;)\n    parser.add_argument(&#39;log_file&#39;,\n                        help=&#39;path to train log file&#39;)\n    parser.add_argument(&#39;--interval&#39;, &#39;-i&#39;, default=30,\n                        help=&#39;plot interval&#39;)\n    parser.add_argument(&#39;--port&#39;, &#39;-p&#39;, default=7777,\n                        help=&#39;server port&#39;)\n    args = parser.parse_args()\n\n    loop = asyncio.get_event_loop()\n    loop.call_soon(plot_loop, args, loop)\n    loop.run_until_complete(build_server(loop, &#39;0.0.0.0&#39;, args.port))\n    try:\n        loop.run_forever()\n    except KeyboardInterrupt:\n        print(&quot;Server shutting down!&quot;)\n        loop.close()\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EThis snippet can also be found \u003Ca href=\"https:\u002F\u002Fgist.github.com\u002Fivylee\u002Ff1b00ce54f948e627605598ccf3cf4b9\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Ehere\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n"}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.cff5f43d.js" defer></script><script src="/assets/js/page--src--templates--journal-post-vue.5e923e24.js" defer></script>
  </body>
</html>
